{% extends "base.html" %}

{% block title %}Order History{% endblock %}

{% block content %}
<h2 class="text-center mb-4">Your Order History</h2>

{% if orders %}
    <div class="table-responsive">
        <table class="table table-hover shadow-sm text-center">
            <thead class="table-dark">
                <tr>
                    <th>Food Item</th>
                    <th>Quantity</th>
                    <th>Total Price</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr id="order-{{ order.id }}">
                    <td>{{ order.food.name }}</td>
                    <td>{{ order.quantity }}</td>
                    <td class="fw-bold text-danger">${{ order.total_price }}</td>
                    <td>{{ order.ordered_at|date:"F d, Y H:i" }}</td>
                    <td>
                        <span class="badge 
                            {% if order.status == 'Pending' %}bg-warning
                            {% elif order.status == 'In Progress' %}bg-info
                            {% elif order.status == 'Completed' %}bg-success
                            {% elif order.status == 'Cancelled' %}bg-danger
                            {% endif %}">
                            {{ order.status }}
                        </span>
                    </td>
                    <td>
                        {% if order.status == "Pending" %}
                            <a href="{% url 'cancel_order' order.id %}" class="btn btn-danger btn-sm">Cancel</a>
                        {% elif order.status == "Completed" %}
                            <span class="btn btn-success btn-sm">Delivered</span>
                        {% else %}
                            <span class="btn btn-secondary btn-sm">{{ order.status }}</span>
                        {% endif %}
                        <button class="btn btn-primary btn-sm" onclick="showOrderDetails('{{ order.id }}', '{{ order.food.name }}', '{{ order.quantity }}', '{{ order.total_price }}', '{{ order.ordered_at }}', '{{ order.status }}')">
                            View Details
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <p class="text-center"><strong>Total Orders:</strong> {{ orders|length }}</p>
{% else %}
    <p class="text-center">You have no past orders.</p>
{% endif %}

<!-- âœ… Order Details Modal -->
<div id="orderDetailsModal" class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Order Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p><strong>Food Item:</strong> <span id="orderFoodName"></span></p>
                <p><strong>Quantity:</strong> <span id="orderQuantity"></span></p>
                <p><strong>Total Price:</strong> $<span id="orderTotalPrice"></span></p>
                <p><strong>Date:</strong> <span id="orderDate"></span></p>
                <p><strong>Status:</strong> <span id="orderStatus"></span></p>
            </div>
        </div>
    </div>
</div>

<script>
    function showOrderDetails(id, foodName, quantity, totalPrice, date, status) {
        document.getElementById("orderFoodName").innerText = foodName;
        document.getElementById("orderQuantity").innerText = quantity;
        document.getElementById("orderTotalPrice").innerText = totalPrice;
        document.getElementById("orderDate").innerText = date;
        document.getElementById("orderStatus").innerText = status;
        
        new bootstrap.Modal(document.getElementById("orderDetailsModal")).show();
    }
</script>

{% endblock %}
